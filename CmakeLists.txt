cmake_minimum_required(VERSION 3.16)
project(smart_home C)
set(CMAKE_C_STANDARD 11)
set(CMAKE_C_STANDARD_REQUIRED ON)

if (CMAKE_C_COMPILER_ID MATCHES "GNU|Clang")
  add_compile_options(-Wall -Wextra -Wpedantic -Wshadow -Wconversion)
endif()

find_package(Threads REQUIRED)
include_directories(${CMAKE_SOURCE_DIR}/include)

add_library(core
  src/queue.c
  src/log.c
  src/device.c
  src/hub.c
)
target_link_libraries(core PUBLIC Threads::Threads)

add_executable(smart_home src/main.c)
target_link_libraries(smart_home PRIVATE core)

add_library(querylib
  src/query.c
  src/log.c
)
target_include_directories(querylib PUBLIC ${CMAKE_SOURCE_DIR}/include)
target_link_libraries(querylib PUBLIC Threads::Threads)

add_executable(iot_query src/query_main.c)
target_link_libraries(iot_query PRIVATE querylib)

add_library(plotlib
  src/plot.c
  src/log.c
)
target_include_directories(plotlib PUBLIC ${CMAKE_SOURCE_DIR}/include)

add_executable(iot_plot src/plot_main.c)
target_link_libraries(iot_plot PRIVATE plotlib)

include(CTest)
if (BUILD_TESTING)
  add_subdirectory(tests)
endif()

install(TARGETS smart_home iot_query iot_plot RUNTIME DESTINATION bin)
